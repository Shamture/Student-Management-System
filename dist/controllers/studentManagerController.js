"use strict";var xtpl=require("xtpl"),path=require("path"),databasemanager=require(path.join(__dirname,"../tools/databasemanager.js"));exports.getStudentListPage=function(e,t){var n=e.query.keyword||"";databasemanager.findList("student_info",{name:{$regex:n}},function(a,d){xtpl.renderFile(path.join(__dirname,"../view/list.html"),{students:d,keyword:n,loginedName:e.session.username},function(e,n){t.send(n)})})},exports.getAddStudentPage=function(e,t){xtpl.renderFile(path.join(__dirname,"../view/add.html"),{loginedName:e.session.username},function(e,n){t.send(n)})},exports.addStudent=function(e,t){databasemanager.insertOne("student_info",e.body,function(e,n){null==n?(t.setHeader("Content-Type","text/html;charset=utf-8"),t.end("<script>alert('插入失败');<\/script>")):(t.setHeader("Content-Type","text/html;charset=utf-8"),t.end("<script>window.location.href='/studentmanager/list'<\/script>"))})},exports.getEditStudentPage=function(e,t){var n=databasemanager.ObjectId(e.params.studentId);databasemanager.findOne("student_info",{_id:n},function(n,a){xtpl.renderFile(path.join(__dirname,"../view/edit.html"),{student:a,loginedName:e.session.username},function(e,n){t.send(n)})})},exports.editStudent=function(e,t){var n=databasemanager.ObjectId(e.params.studentId);databasemanager.updateOne("student_info",{_id:n},e.body,function(e,n){null==n?(t.setHeader("Content-Type","text/html;charset=utf-8"),t.end("<script>alert('修改失败');<\/script>")):(t.setHeader("Content-Type","text/html;charset=utf-8"),t.end("<script>window.location.href='/studentmanager/list'<\/script>"))})},exports.deleteStudent=function(e,t){var n=databasemanager.ObjectId(e.params.studentId);databasemanager.deleteOne("student_info",{_id:n},function(e,n){null==n?(t.setHeader("Content-Type","text/html;charset=utf-8"),t.end("<script>alert('删除失败');<\/script>")):(t.setHeader("Content-Type","text/html;charset=utf-8"),t.end("<script>window.location.href='/studentmanager/list'<\/script>"))})};